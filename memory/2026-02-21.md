# 2026-02-21 (土)

## 新規プロジェクト：ojiasobi（中年男性向け趣味サイト）

**プロジェクト開始**: 2026-02-21  
**場所**: `/Users/lost_and_found/lab/ojiasobi/`

### プロジェクト概要
- **ターゲット**: 中年男性（特に独身）
- **コンセプト**: 孤独に寄り添う、一人で完結する趣味、低コスト、ニッチ（ブルーオーシャン）
- **必須トピック**: 鉄のフライパンを育てる

### 記事の必須要素（4点）
1. 始めやすさ（具体的なコスト提示）
2. 明確な魅力（成長が見える、達成感）
3. 科学的・知的深さ（化学的メカニズム、例：乾性油の重合反応）
4. 次への道（次のステップ、関連趣味）

### 評価基準（RUBRIC.md）
6項目、各5点満点、26点以上が最優先：
1. 成長の可視化
2. 実用性
3. 初期コスト
4. 一人で完結
5. 奥深さ
6. ニッチ度

### 完了済み
- LIST.md（趣味トピック候補）作成
- RUBRIC.md（評価基準）作成
- EVALUATION.md（20+トピック評価）作成
- WRITING_POLICY.md（記事構成・執筆ガイドライン）作成
- トップ6トピック選定: フライパン(29), スパイスカレー(28), 漬物・発酵食品(27), 靴磨き(27), パン作り(26), 園芸(26)
- **第1弾記事テーマ決定**: 育てる鉄のフライパン（29点・最高評価）

### 進行中
- Claude Code セッション（marine-sage）で記事作成準備中
- 3フェーズ体制（Research → Write → Review）

### 技術的課題
- 過去のClaude Codeセッション（cool-haven, lucky-summit）が30分でSIGKILL
- Brave API未設定でweb_search使えず
- → 知識ベース（2025-08カットオフ）から直接執筆する方針

### 記事構成（WRITING_POLICY.md）
7セクション構成：
1. 導入
2. ハードルの正体
3. 魅力
4. 科学的・知的深さ
5. 始め方
6. 次のステップ
7. まとめ

### 重要な表現例
科学的説明の例: 「乾性油（リノール酸、リノレン酸）が空気中の酸素と反応し、重合反応を起こして硬い皮膜を形成します。これが『油膜』の正体。」

### 次のステップ
1. ディレクトリ構造作成（research/, articles/, reviews/）
2. リサーチフェーズ実行
3. 執筆フェーズ実行
4. レビューフェーズ実行
5. 次の記事候補: スパイスカレー作り(28点) or 靴磨き(27点)

---

## Claude Code の理解

### 基本的な使い方
- **必須**: `pty:true` （対話的ターミナルアプリケーションのため）
- **推奨**: `workdir` 指定（プロジェクトディレクトリを明示）
- **長時間タスク**: `background:true` で非同期実行

### Agent Teams（実験的機能）

**公式ドキュメント**: https://code.claude.com/docs/en/agent-teams

**概要**:
- 複数の Claude Code インスタンスをチームとして協調動作させる機能
- **デフォルトで無効**、環境変数で有効化が必要
- 実験的機能であり、制限あり

**有効化方法**:
```json
{
  "env": {
    "CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS": "1"
  }
}
```

**特徴**:
- ✅ リーダー（Lead）が全体を統括
- ✅ チームメイト（Teammate）が独立したコンテキストで作業
- ✅ 共有タスクリストで作業管理
- ✅ エージェント間メッセージング（直接通信可能）
- ❌ 高トークンコスト（各チームメイトが完全なClaude Codeインスタンス）

**vs Subagents（サブエージェント）**:

| 項目 | Subagents | Agent Teams |
|------|-----------|-------------|
| コンテキスト | 1つのセッション内 | 複数の独立したセッション |
| 通信 | メインエージェントに結果を返すのみ | エージェント同士が直接メッセージング |
| 調整 | メインエージェントが全管理 | 共有タスクリストで自己調整 |
| コスト | 低（結果のみ返す） | 高（各チームメイトが完全インスタンス） |
| 適用場面 | 軽量・焦点を絞ったタスク | 複数の独立した探索・実装が必要なタスク |

**使い分け**:
- **Subagents**: 結果だけが重要な焦点を絞ったタスク
- **Agent Teams**: エージェント同士の議論・協調が必要な複雑なタスク

**制限事項**:
- セッション再開不可（in-processモード）
- タスク状態の遅延あり
- 1セッションに1チームのみ
- チームメイトは他のチームメイトを生成不可
- リーダーは固定（昇格不可）

**ojiasobi プロジェクトへの適用**:
- 記事作成には **Agent Teams は不要**
- 単一セッションまたは Subagents で十分
- 元記事（note.com/fladdict）は比喩的表現で、実際の実装には不要

---

## claude-code スキル作成完了

**場所**: `~/.openclaw/skills/claude-code/`

**構成**:
- `SKILL.md` - メインスキル定義（汎用的なClaude Code利用）
- `references/TODO-PATTERN.md` - TODO.md連携パターン
- `references/BACKGROUND-TASKS.md` - バックグラウンドタスク管理

**特徴**:
- 記事作成に限定しない汎用スキル
- ワンショット実行からバックグラウンド長時間実行まで対応
- pty:true の重要性、workdir指定、完了通知パターンを含む

**テスト結果**:
- ✅ Claude Code 正常起動
- ✅ hello.py ファイル作成成功
- ✅ 「TASK COMPLETE」メッセージ出力確認

**使い方**:
```
Use the claude-code skill to work on [プロジェクトパス]/TODO.md in background mode
```

---

## OpenClaw ↔ Claude Code 連携ワークフロー確立

**作成ファイル**:
- `AGENTS.md` - 役割分担定義（OpenClaw = オーケストレーター、Claude Code = 実行者）
- `TODO.md` - タスクキュー（Claude Codeが管理・更新、OpenClawは読み取り専用）
- `REPORT.md` - 実行ログ（Claude Codeが追記、監査証跡）

**ワークフロー**:
1. **OpenClaw**: TODO.mdを読み取り → タスクがあれば Claude Code 起動
2. **Claude Code**: TODO.mdからタスク取得 → 実行 → REPORT.md追記 → TODO.md更新
3. **OpenClaw**: 完了通知受信 → 次のタスクをチェック

**Hybrid Trigger パターン**:
- 15分間隔のcronジョブでTODO.mdをチェック
- タスク有 + プロセス未実行 → Claude Code自動起動
- 自己修復機能（プロセス死亡時も次回cronで復旧）

---

## ojiasobi-auto-writer cronジョブ作成

**ジョブID**: `d00df0b7-a63e-43bd-b859-884d14ebba8a`  
**スケジュール**: 15分間隔（everyMs: 900000）  
**タイプ**: systemEvent → main session  
**動作**:
1. TODO.mdを読み取り
2. 未完了タスク有 + Claude Codeプロセス未実行 → 起動
3. プロセス実行中 → スキップ

**利点**:
- 完全自動化（ユーザー介入不要）
- 自己修復（プロセス異常終了時も次回cronで再起動）
- シンプル（Hookなし、cron単独）

---

## 第1弾記事「育てる鉄のフライパン」作成開始

**実行方法**: 手動Claude Codeセッション起動（ユーザーリクエスト: "ではtodoを回していこう"）

**Claude Codeセッション**:
- **セッション名**: oceanic-valley
- **PID**: 57160
- **タイムアウト**: 1時間
- **作業ディレクトリ**: `/Users/lost_and_found/lab/ojiasobi/`
- **タスク**: TODO.md Phase 1（Research）

**Phase 1 Research タスク内容**:
1. 乾性油の重合反応メカニズム
2. シーズニング（油膜形成）の科学
3. オムレツが滑るようになる道筋
4. 初期コスト（フライパン＋調理油）

**アプローチ**:
- web_search利用不可（Brave API未設定）
- 知識ベース（2025-08カットオフ）から直接執筆
- WRITING_POLICY.mdに準拠した内容構成

**次のステップ**:
1. oceanic-valley セッション完了待ち
2. Phase 2（Outline）実行
3. Phase 3（Writing）で記事完成
4. 次記事候補: スパイスカレー(28点) or 靴磨き(27点)

---

## 第1弾記事「育てる鉄のフライパン」完成 ✅

**実行セッション**:
- Phase 1（Research）: oceanic-valley
- Phase 2（Writing）: rapid-rook（PID 65302）

**成果物**:
- `articles/iron-frypan-seasoning.md`（15KB、230行、約4,280文字）
- 7セクション構成（WRITING_POLICY.md準拠）
- 科学的メカニズム解説（乾性油の重合反応、カルボニル化合物の重要性）
- 具体的なコスト提示（初期投資3,000円台〜）

**レビュー結果**:
- `reviews/iron-frypan-seasoning_review.md`（8KB、163行）
- **総合評価**: 38/40点（⭐⭐⭐⭐⭐）
- **強み**: 科学的深さ、具体的コスト、成長ロードマップ
- **微修正点**: 記事タイトルの軽微な改善提案（既に対応済み）

---

## Claude Code 自動承認設定の確立

**背景**: 
- 実行中に「Do you want to create/edit file?」プロンプトで一時停止
- 完全自動化には承認スキップが必要

**解決策**:
- プロジェクト固有の設定: `.claude/settings.json`
- `permissionMode: "acceptEdits"` 採用
- ✅ ファイル編集を自動承認
- ❌ `bypassPermissions` は過剰（すべての権限をスキップ）

**設定内容**:
```json
{
  "permissionMode": "acceptEdits"
}
```

**注意事項**:
- グローバル設定（`~/.claude/settings.json`）は変更しない
- プロジェクト単位で設定することで影響範囲を限定

**AGENTS.md更新**:
- Claude Code設定セクション追加
- 自動承認の理由と方法を文書化

---

## 第2弾記事「スパイスカレー作り」開始

**テーマ**: スパイスカレー作り（評価28点、第2位）

**実行状況**:
- **Phase 1（Research）**: 進行中
- **セッション名**: nova-crustacean
- **PID**: 70475
- **リサーチ項目**:
  1. スパイスの科学（揮発性・脂溶性成分、メイラード反応）
  2. 基本の4スパイス（クミン、コリアンダー、ターメリック、チリ）
  3. テンパリングのメカニズム
  4. 初期コスト（スパイスセット、調理器具）
  5. ブレンドの芸術性（比率調整、香りの構造）

**TODO.md構造**:
- Phase 1: Research（進行中）
- Phase 2: Write Article（待機中）
- Phase 3: Review Article（待機中）

**次のアクション**:
1. nova-crustacean セッション完了待ち
2. 完了通知後、Phase 2（Write Article）起動
3. Phase 3（Review Article）実行
4. 第1記事の公開検討（38/40点の完成度）

---

## 重要な学習事項

### Claude Code実行時の必須事項
- **pty:true は絶対必須**（対話的ターミナルアプリのため）
- workdir指定推奨（プロジェクトディレクトリを明示）
- background:true で長時間タスク対応
- 完了通知パターン: `openclaw system event --text "Done" --mode now`

### Agent Teams vs 単一セッション/Subagents
- **Agent Teams**: 高コスト、複雑なタスク向け、ojiasobiには不要
- **単一セッション**: ojiasobiの記事作成に十分
- **判断基準**: 結果だけが重要なら単一セッション、複数エージェント協調が必要ならAgent Teams

### プロジェクト管理の教訓
- TODO.md/REPORT.mdパターンが有効（役割分離、監査証跡）
- cronベースの自動実行が実用的（Hook不要、シンプル）
- ワークフロー定義（AGENTS.md）で混乱回避

---

## ojiasobi完全自動化システム構築完了 ✅

**目標**: 記事生成からDiscord投稿まで完全自律動作

**実装内容**:

### 1. Claude Code Hooks設定（`.claude/settings.json`）

**PostToolUse Hook**:
- トリガー: 記事執筆後の確認タイミング
- チェック内容: 記事の品質確認（リンク切れ、誤字脱字など）
- タイムアウト: 5秒（軽量チェック）

**Stop Hook**（記事完成時の自動投稿）:
- トリガー: Claude Codeセッション終了時
- 実行内容:
  1. `node ./scripts/post-article.js`（Discord投稿・同期・60秒タイムアウト）
  2. `./scripts/auto-post-article.sh`（OpenClaw通知・非同期・10秒タイムアウト）

### 2. Discord自動投稿スクリプト（`scripts/post-article.js`）

**技術選択**: Node.jsベースのスクリプト
- **理由**: `openclaw message send`コマンドは`exec`から正常動作せず、シェルスクリプトでは不安定
- **解決策**: `child_process.execSync`でNode.jsから同期実行

**主な機能**:
- 最新記事の自動検出（articlesディレクトリ内、mtime順）
- Discord 2000文字制限対応（1900文字でチャンク分割）
- 複数チャンク投稿（順次実行）
- エラーハンドリング（エラーメッセージをstderr出力）

**実行コマンド**:
```bash
openclaw message send --channel discord --target "#オジアソビ" --message "..."
```

### 3. OpenClaw通知スクリプト（`scripts/auto-post-article.sh`）

**機能**: Discord投稿完了後の非同期通知
- セッション通知: "記事をDiscordに投稿しました 🌸"
- システムイベント: `mode=now`で即座にOpenClawに通知

### 4. 自動承認設定（`acceptEdits`モード）

**設定内容**:
```json
{
  "permissionMode": "acceptEdits",
  "sandbox": false
}
```
- ファイル作成・編集を自動承認
- サンドボックス無効化（OpenClaw CLI統合に必要）

### 5. 完全自律サイクル

**フロー**:
1. **15分間隔cron** → TODO.mdチェック → Claude Code起動
2. **Claude Code** → 記事生成 → Phase完了 → セッション終了
3. **Stop Hook** → `post-article.js`（Discord投稿） → `auto-post-article.sh`（OpenClaw通知）
4. **次回cron** → 次のPhaseをチェック → 繰り返し

**人間の介入不要**: 記事生成からDiscord投稿まで完全自動

---

## 第2弾記事「スパイスカレー作り」Phase 2完了 ✅

**実行セッション**: briny-gulf

**成果物**:
- `articles/spice-curry.md`（268行、約7,500文字）
- 7セクション構成（WRITING_POLICY.md準拠）

**記事構成**:
1. 導入（スパイスカレーの魅力と誤解の解消）
2. ハードルの正体（知識不足、スパイス入手、失敗の不安）
3. 魅力（「何もない状態」からの創造、科学と芸術の融合）
4. 科学的・知的深さ（スパイスの化学、テンパリング、メイラード反応）
5. 始め方（最小構成4スパイス、初期コスト1,500円〜）
6. 次のステップ（スパイス探求、カレー以外への応用）
7. まとめ

**特徴**:
- 初期コスト明示（スパイス4種：1,500円〜、調理器具は既存で可）
- 科学的メカニズム（脂溶性・揮発性成分、アリルイソチオシアネート、クルクミン）
- 成長ロードマップ（基本4スパイス → ホールスパイス → 自家焙煎）

**TODO.md更新**:
- Phase 2を「✅ 完了 2026-02-21」に更新
- Phase 3（Review）が次のタスク

**セッション終了**:
- システムイベント送信: "Phase 2完了：スパイスカレー記事執筆 🌸"

**次のアクション**:
1. 次回cron（15分後）でPhase 3（Review）自動起動予定
2. Hook設定が次回サイクルで初適用される見込み
3. Discord自動投稿フローの実地テスト

---

## 技術的重要事項（自動化システム）

### Stop Hookの選択理由
- **代替案**: 別途cronでDiscord投稿ジョブを作成
- **採用理由**: Stop Hookなら記事完成と同時に投稿可能（シンプル）
- **タイミング**: セッション終了 = 記事完成なので適切

### Node.js採用の理由
- **問題**: `exec`からの`openclaw message send`が不安定
- **解決**: Node.jsの`child_process.execSync`で安定実行
- **メリット**: エラーハンドリング、文字列処理、非同期制御が容易

### Discord 2000文字制限対策
- **分割位置**: 1900文字（安全マージン100文字）
- **分割方法**: 段落境界で分割（可読性維持）
- **送信**: 順次実行（chunk間の遅延なし、Discord APIが処理）

### セキュリティ考慮
- **サンドボックス無効化**: OpenClaw CLI統合に必須だが、プロジェクト限定設定で影響範囲を最小化
- **自動承認範囲**: `acceptEdits`のみ（ファイル操作限定、ネットワークアクセスなどは対象外）

---

## 次の目標

1. **Phase 3完了確認**: スパイスカレー記事のレビュー実行
2. **Hook動作検証**: Discord自動投稿が正常動作するか確認
3. **第1弾記事公開検討**: 鉄のフライパン記事（38/40点）
4. **次記事候補**: 靴磨き(27点) or 漬物・発酵食品(27点)
